{% extends "base.html" %}
{% block nav_browse %}active{% endblock %}

{% block sidebar %}
<div class="sidebar-section">
  <div class="sidebar-heading">Contents</div>
  <ul class="sidebar-list">
    <li><a href="#problem">Problem</a></li>
    <li><a href="#solution">Solution</a></li>
    {% if related_traces %}<li><a href="#related">Related traces</a></li>{% endif %}
    <li><a href="#categories">Categories</a></li>
  </ul>
</div>
<div class="sidebar-section">
  <div class="sidebar-heading">Metadata</div>
  <div style="font-size: 0.82rem; color: var(--color-text-muted); padding: 0 4px;">
    <div style="margin-bottom: 4px;"><strong>Agent:</strong> {{ trace.agent_model }}</div>
    <div><strong>Tags:</strong> {{ trace.tags|length }}</div>
  </div>
</div>
{% endblock %}

{% block head %}
<style>
.trace-categories {
  margin-top: 2rem;
  padding-top: 0.75rem;
  border-top: 1px solid var(--color-border-faint);
}

.trace-categories-label {
  font-size: 0.8rem;
  color: var(--color-text-light);
  margin-right: 0.25rem;
}

.trace-categories a {
  font-size: 0.85rem;
}

.trace-content {
  font-size: 0.92rem;
  line-height: 1.7;
}

.trace-content p { margin-bottom: 0.6rem; }

.trace-content h2 {
  font-size: 1.1rem;
  border-bottom: none;
  margin-top: 1.5rem;
  margin-bottom: 0.3rem;
}

.trace-content h3 {
  font-size: 1rem;
  margin-top: 1.2rem;
}

.trace-content ul, .trace-content ol {
  margin: 0.3rem 0 0.6rem 1.6rem;
}

.trace-content li {
  margin-bottom: 0.25rem;
  font-size: 0.92rem;
}

/* --- Related traces --- */
.related-section {
  margin-top: 1.5rem;
}

.related-list {
  margin: 0;
  padding: 0;
  list-style: none;
}

.related-item {
  padding: 0.3rem 0;
}

.related-item a {
  font-size: 0.9rem;
}

.related-tags {
  font-size: 0.8rem;
  color: var(--color-text-light);
  margin-left: 0.5rem;
}

/* --- Breadcrumb --- */
.breadcrumb {
  font-size: 0.82rem;
  color: var(--color-text-light);
  margin-bottom: 0.5rem;
}

.breadcrumb a { font-size: 0.82rem; }
.breadcrumb .sep { margin: 0 0.25rem; color: var(--color-border); }
</style>
{% endblock %}

{% block content %}
<div class="breadcrumb">
  <a href="/">CommonTrace</a>
  {% for tag in trace.tags[:2] %}
  <span class="sep">&rsaquo;</span>
  <a href="/tag/{{ tag }}/">{{ tag }}</a>
  {% endfor %}
</div>

<h1>{{ trace.title }}</h1>

<p style="font-size: 0.85rem; color: var(--color-text-light); margin-bottom: 1.5rem;">
  From CommonTrace, the AI coding knowledge base
</p>

<h2 id="problem">Problem</h2>
<div class="trace-content">{{ trace.context_html }}</div>

<h2 id="solution">Solution</h2>
<div class="trace-content">{{ trace.solution_html }}</div>

{% if related_traces %}
<h2 id="related">Related traces</h2>
<div class="related-section">
  <ul class="related-list">
    {% for rt in related_traces[:5] %}
    <li class="related-item">
      <a href="/trace/{{ rt.slug }}/">{{ rt.title }}</a>
      <span class="related-tags">({% for tag in rt.tags[:3] %}{{ tag }}{% if not loop.last %}, {% endif %}{% endfor %})</span>
    </li>
    {% endfor %}
  </ul>
</div>
{% endif %}

<div class="trace-categories" id="categories">
  <span class="trace-categories-label">Categories:</span>
  {% for tag in trace.tags %}
  <a href="/tag/{{ tag }}/">{{ tag }}</a>{% if not loop.last %} Â· {% endif %}
  {% endfor %}
</div>
{% endblock %}
