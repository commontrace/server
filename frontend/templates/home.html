{% extends "base.html" %}

{% block head %}
<style>
/* ==========================================================================
   Homepage — CommonTrace
   ==========================================================================
   Full-bleed layout: hero breaks out of the sidebar/content structure.
   The homepage hides the default page layout and uses its own sections.
   ========================================================================== */

/* Override base layout: homepage is full-width, no sidebar */
.ct-page { display: none; }
.ct-footer { display: none; }

/* The homepage content wrapper lives outside .ct-page via JS relocation */
.home-shell {
  display: none;
}

.home-shell.home-active {
  display: block;
}

/* Force nav to start transparent on dark hero */
.ct-nav.ct-nav--home {
  background: transparent;
  border-bottom-color: transparent;
}

.ct-nav.ct-nav--home .ct-nav__logo-text { color: var(--ct-dark-text); }
.ct-nav.ct-nav--home .ct-nav__links a { color: var(--ct-dark-text-muted); }
.ct-nav.ct-nav--home .ct-nav__links a:visited { color: var(--ct-dark-text-muted); }
.ct-nav.ct-nav--home .ct-nav__links a:hover { color: var(--ct-dark-text); background: var(--ct-dark-surface); }
.ct-nav.ct-nav--home .ct-nav__github { color: var(--ct-dark-text-muted); }
.ct-nav.ct-nav--home .ct-nav__github:hover { color: var(--ct-dark-text); }
.ct-nav.ct-nav--home .ct-nav__mobile-toggle { border-color: var(--ct-dark-border); color: var(--ct-dark-text-muted); }
.ct-nav.ct-nav--home .ct-nav__badge { background: rgba(59, 130, 246, 0.15); }

.ct-nav.ct-nav--home.ct-nav--scrolled {
  background: rgba(8, 12, 24, 0.92);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border-bottom-color: var(--ct-dark-border);
}

/* ---- SECTION 1: HERO ---- */
.hero {
  position: relative;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: var(--ct-dark-bg);
  overflow: hidden;
  padding: var(--ct-space-4xl) var(--ct-space-lg) var(--ct-space-3xl);
}

/* Subtle radial glow behind hero content */
.hero::before {
  content: '';
  position: absolute;
  top: 15%;
  left: 50%;
  transform: translateX(-50%);
  width: 800px;
  height: 600px;
  background: radial-gradient(ellipse, rgba(59, 130, 246, 0.08) 0%, rgba(139, 92, 246, 0.04) 40%, transparent 70%);
  pointer-events: none;
}

/* Animated floating dots — the neural network */
.hero__dots {
  position: absolute;
  inset: 0;
  overflow: hidden;
  pointer-events: none;
}

.hero__dot {
  position: absolute;
  width: 3px;
  height: 3px;
  border-radius: 50%;
  background: rgba(59, 130, 246, 0.35);
  animation: ct-float linear infinite;
}

.hero__dot:nth-child(2) { background: rgba(139, 92, 246, 0.3); }
.hero__dot:nth-child(5) { background: rgba(139, 92, 246, 0.25); }
.hero__dot:nth-child(8) { background: rgba(59, 130, 246, 0.2); }
.hero__dot:nth-child(11) { background: rgba(139, 92, 246, 0.35); }
.hero__dot:nth-child(14) { background: rgba(59, 130, 246, 0.25); }
.hero__dot:nth-child(17) { background: rgba(139, 92, 246, 0.2); }

/* 18 dots with varied positions, sizes, and timing */
.hero__dot:nth-child(1)  { left: 8%;  top: 15%; width: 3px; height: 3px; animation-duration: 28s; animation-delay: 0s; }
.hero__dot:nth-child(2)  { left: 18%; top: 70%; width: 2px; height: 2px; animation-duration: 34s; animation-delay: -4s; }
.hero__dot:nth-child(3)  { left: 25%; top: 35%; width: 4px; height: 4px; animation-duration: 26s; animation-delay: -8s; }
.hero__dot:nth-child(4)  { left: 35%; top: 80%; width: 2px; height: 2px; animation-duration: 32s; animation-delay: -2s; }
.hero__dot:nth-child(5)  { left: 42%; top: 20%; width: 3px; height: 3px; animation-duration: 30s; animation-delay: -12s; }
.hero__dot:nth-child(6)  { left: 52%; top: 55%; width: 2px; height: 2px; animation-duration: 36s; animation-delay: -6s; }
.hero__dot:nth-child(7)  { left: 60%; top: 10%; width: 3px; height: 3px; animation-duration: 28s; animation-delay: -16s; }
.hero__dot:nth-child(8)  { left: 68%; top: 65%; width: 4px; height: 4px; animation-duration: 24s; animation-delay: -3s; }
.hero__dot:nth-child(9)  { left: 75%; top: 40%; width: 2px; height: 2px; animation-duration: 30s; animation-delay: -10s; }
.hero__dot:nth-child(10) { left: 85%; top: 75%; width: 3px; height: 3px; animation-duration: 34s; animation-delay: -7s; }
.hero__dot:nth-child(11) { left: 92%; top: 25%; width: 2px; height: 2px; animation-duration: 26s; animation-delay: -14s; }
.hero__dot:nth-child(12) { left: 12%; top: 50%; width: 3px; height: 3px; animation-duration: 32s; animation-delay: -5s; }
.hero__dot:nth-child(13) { left: 30%; top: 5%;  width: 2px; height: 2px; animation-duration: 28s; animation-delay: -9s; }
.hero__dot:nth-child(14) { left: 48%; top: 85%; width: 3px; height: 3px; animation-duration: 36s; animation-delay: -1s; }
.hero__dot:nth-child(15) { left: 55%; top: 30%; width: 2px; height: 2px; animation-duration: 30s; animation-delay: -11s; }
.hero__dot:nth-child(16) { left: 78%; top: 55%; width: 4px; height: 4px; animation-duration: 26s; animation-delay: -15s; }
.hero__dot:nth-child(17) { left: 5%;  top: 88%; width: 2px; height: 2px; animation-duration: 34s; animation-delay: -13s; }
.hero__dot:nth-child(18) { left: 90%; top: 50%; width: 3px; height: 3px; animation-duration: 28s; animation-delay: -8s; }

@keyframes ct-float {
  0% {
    transform: translate(0, 0) scale(1);
    opacity: 0;
  }
  5% {
    opacity: 1;
  }
  25% {
    transform: translate(30px, -40px) scale(1.2);
  }
  50% {
    transform: translate(-20px, -80px) scale(0.8);
    opacity: 0.6;
  }
  75% {
    transform: translate(40px, -30px) scale(1.1);
  }
  95% {
    opacity: 1;
  }
  100% {
    transform: translate(0, 0) scale(1);
    opacity: 0;
  }
}

.hero__content {
  position: relative;
  z-index: 2;
  text-align: center;
  max-width: 780px;
}

.hero__eyebrow {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-family: var(--ct-font-body);
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--ct-accent);
  letter-spacing: 0.08em;
  text-transform: uppercase;
  margin-bottom: var(--ct-space-lg);
}

.hero__eyebrow-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--ct-accent);
  animation: ct-pulse 2s ease-in-out infinite;
}

.hero__title {
  font-family: var(--ct-font-display);
  font-size: clamp(2.5rem, 6vw, 4.5rem);
  font-weight: 400;
  color: var(--ct-dark-text);
  line-height: 1.08;
  letter-spacing: -0.025em;
  margin-bottom: var(--ct-space-lg);
  border: none;
  padding: 0;
}

.hero__title em {
  font-style: italic;
  background: var(--ct-gradient-accent);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero__subtitle {
  font-family: var(--ct-font-body);
  font-size: clamp(1rem, 2vw, 1.2rem);
  font-weight: 400;
  color: var(--ct-dark-text-muted);
  line-height: 1.6;
  max-width: 560px;
  margin: 0 auto var(--ct-space-xl);
}

.hero__cta {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-family: var(--ct-font-body);
  font-size: 1rem;
  font-weight: 600;
  color: white;
  background: var(--ct-gradient-accent);
  padding: 14px 32px;
  border-radius: var(--ct-border-radius-pill);
  text-decoration: none;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  box-shadow: 0 4px 24px rgba(59, 130, 246, 0.25);
}

.hero__cta:hover {
  transform: translateY(-1px);
  box-shadow: 0 8px 32px rgba(59, 130, 246, 0.35);
  text-decoration: none;
  color: white;
}

.hero__cta:visited { color: white; }

.hero__cta-arrow {
  transition: transform 0.2s ease;
}

.hero__cta:hover .hero__cta-arrow {
  transform: translateX(3px);
}

/* Hero Stats */
.hero__stats {
  display: flex;
  justify-content: center;
  gap: var(--ct-space-3xl);
  margin-top: var(--ct-space-3xl);
  padding-top: var(--ct-space-xl);
  border-top: 1px solid var(--ct-dark-border);
}

.hero__stat {
  text-align: center;
}

.hero__stat-number {
  display: block;
  font-family: var(--ct-font-display);
  font-size: 2.25rem;
  font-weight: 400;
  color: var(--ct-dark-text);
  line-height: 1.1;
  letter-spacing: -0.02em;
}

.hero__stat-label {
  font-family: var(--ct-font-body);
  font-size: 0.85rem;
  color: var(--ct-dark-text-faint);
  margin-top: 2px;
}

/* ---- SECTION 2: FEATURED TRACES (dark-to-light transition) ---- */
.featured {
  position: relative;
  padding: var(--ct-space-4xl) var(--ct-space-lg);
  background: linear-gradient(180deg, var(--ct-dark-bg) 0%, var(--ct-dark-bg-subtle) 15%, #111827 60%, #1f2937 85%, var(--ct-light-bg) 100%);
}

.featured__inner {
  max-width: var(--ct-content-max);
  margin: 0 auto;
}

.featured__header {
  text-align: center;
  margin-bottom: var(--ct-space-3xl);
}

.featured__label {
  font-family: var(--ct-font-body);
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--ct-accent);
  letter-spacing: 0.08em;
  text-transform: uppercase;
  margin-bottom: var(--ct-space-sm);
}

.featured__title {
  font-family: var(--ct-font-display);
  font-size: clamp(1.75rem, 3.5vw, 2.5rem);
  font-weight: 400;
  color: var(--ct-dark-text);
  border: none;
  padding: 0;
  margin: 0;
}

.featured__grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--ct-space-lg);
}

.featured__card {
  background: rgba(255, 255, 255, 0.04);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: var(--ct-border-radius-lg);
  padding: var(--ct-space-xl);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  transition: background 0.25s ease, border-color 0.25s ease, transform 0.25s ease;
}

.featured__card:hover {
  background: rgba(255, 255, 255, 0.07);
  border-color: rgba(255, 255, 255, 0.14);
  transform: translateY(-2px);
}

.featured__card-title {
  font-family: var(--ct-font-body);
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: var(--ct-space-sm);
  line-height: 1.35;
  border: none;
  padding: 0;
}

.featured__card-title a {
  color: var(--ct-dark-text);
  text-decoration: none;
  transition: color 0.15s ease;
}

.featured__card-title a:visited { color: var(--ct-dark-text); }
.featured__card-title a:hover { color: var(--ct-accent); text-decoration: none; }

.featured__card-excerpt {
  font-size: 0.875rem;
  color: var(--ct-dark-text-muted);
  line-height: 1.6;
  margin-bottom: var(--ct-space-md);
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.featured__card-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.featured__card-tag {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--ct-accent);
  background: var(--ct-accent-soft);
  padding: 3px 10px;
  border-radius: var(--ct-border-radius-pill);
  text-decoration: none;
  transition: background 0.15s ease;
}

.featured__card-tag:visited { color: var(--ct-accent); }
.featured__card-tag:hover { background: rgba(59, 130, 246, 0.2); text-decoration: none; }

.featured__card-tag--violet {
  color: var(--ct-violet);
  background: var(--ct-violet-soft);
}

.featured__card-tag--violet:visited { color: var(--ct-violet); }
.featured__card-tag--violet:hover { background: rgba(139, 92, 246, 0.2); }

/* ---- SECTION 3: HOW IT WORKS ---- */
.how-it-works {
  padding: var(--ct-space-4xl) var(--ct-space-lg);
  background: var(--ct-light-bg);
}

.how-it-works__inner {
  max-width: 960px;
  margin: 0 auto;
}

.how-it-works__header {
  text-align: center;
  margin-bottom: var(--ct-space-3xl);
}

.how-it-works__label {
  font-family: var(--ct-font-body);
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--ct-violet);
  letter-spacing: 0.08em;
  text-transform: uppercase;
  margin-bottom: var(--ct-space-sm);
}

.how-it-works__title {
  font-family: var(--ct-font-display);
  font-size: clamp(1.75rem, 3.5vw, 2.5rem);
  font-weight: 400;
  color: var(--ct-light-text);
  border: none;
  padding: 0;
  margin: 0;
}

.how-it-works__steps {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: var(--ct-space-xl);
}

.how-it-works__step {
  text-align: center;
  padding: var(--ct-space-lg);
}

.how-it-works__step-number {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  font-family: var(--ct-font-display);
  font-size: 1.25rem;
  margin-bottom: var(--ct-space-md);
}

.how-it-works__step:nth-child(1) .how-it-works__step-number {
  background: var(--ct-accent-soft);
  color: var(--ct-accent);
}

.how-it-works__step:nth-child(2) .how-it-works__step-number {
  background: var(--ct-violet-soft);
  color: var(--ct-violet);
}

.how-it-works__step:nth-child(3) .how-it-works__step-number {
  background: rgba(16, 185, 129, 0.1);
  color: #10b981;
}

.how-it-works__step:nth-child(4) .how-it-works__step-number {
  background: rgba(245, 158, 11, 0.1);
  color: #f59e0b;
}

.how-it-works__step-title {
  font-family: var(--ct-font-body);
  font-size: 1rem;
  font-weight: 600;
  color: var(--ct-light-text);
  margin-bottom: var(--ct-space-sm);
  border: none;
  padding: 0;
}

.how-it-works__step-desc {
  font-size: 0.875rem;
  color: var(--ct-light-text-muted);
  line-height: 1.6;
}

/* ---- SECTION 4: CATEGORIES ---- */
.categories {
  padding: var(--ct-space-3xl) var(--ct-space-lg) var(--ct-space-4xl);
  background: var(--ct-light-bg);
}

.categories__inner {
  max-width: 960px;
  margin: 0 auto;
}

.categories__header {
  text-align: center;
  margin-bottom: var(--ct-space-xl);
}

.categories__label {
  font-family: var(--ct-font-body);
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--ct-accent);
  letter-spacing: 0.08em;
  text-transform: uppercase;
  margin-bottom: var(--ct-space-sm);
}

.categories__title {
  font-family: var(--ct-font-display);
  font-size: clamp(1.5rem, 3vw, 2rem);
  font-weight: 400;
  color: var(--ct-light-text);
  border: none;
  padding: 0;
  margin: 0;
}

.categories__pills {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin-bottom: var(--ct-space-xl);
}

.categories__pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-family: var(--ct-font-body);
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--ct-light-text);
  background: var(--ct-light-bg-alt);
  border: 1px solid var(--ct-light-border);
  padding: 8px 16px;
  border-radius: var(--ct-border-radius-pill);
  text-decoration: none;
  transition: border-color 0.2s ease, background 0.2s ease, transform 0.2s ease;
}

.categories__pill:visited { color: var(--ct-light-text); }

.categories__pill:hover {
  border-color: var(--ct-accent);
  background: var(--ct-accent-soft);
  color: var(--ct-accent);
  transform: translateY(-1px);
  text-decoration: none;
}

.categories__pill-count {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--ct-light-text-faint);
  background: var(--ct-light-border-faint);
  padding: 2px 8px;
  border-radius: var(--ct-border-radius-pill);
}

.categories__pill:hover .categories__pill-count {
  background: rgba(59, 130, 246, 0.15);
  color: var(--ct-accent);
}

.categories__browse {
  text-align: center;
}

.categories__browse a {
  font-family: var(--ct-font-body);
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--ct-accent);
  text-decoration: none;
  transition: color 0.15s ease;
}

.categories__browse a:hover {
  color: var(--ct-accent-hover);
  text-decoration: underline;
}

/* ---- HOMEPAGE FOOTER: dark variant ---- */
.home-footer {
  background: var(--ct-dark-bg);
  border-top: 1px solid var(--ct-dark-border);
  padding: var(--ct-space-3xl) var(--ct-space-lg);
}

.home-footer__inner {
  max-width: var(--ct-content-max);
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: var(--ct-space-md);
}

.home-footer__brand {
  display: flex;
  align-items: center;
  gap: 10px;
}

.home-footer__logo-mark {
  width: 28px;
  height: 28px;
  border-radius: 8px;
  background: var(--ct-gradient-accent);
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--ct-font-display);
  font-size: 0.9rem;
  color: white;
}

.home-footer__text {
  color: var(--ct-dark-text-muted);
  font-size: 0.85rem;
}

.home-footer__links {
  display: flex;
  gap: var(--ct-space-lg);
  list-style: none;
  margin: 0;
  padding: 0;
}

.home-footer__links a {
  font-size: 0.85rem;
  color: var(--ct-dark-text-faint);
  text-decoration: none;
  transition: color 0.15s ease;
}

.home-footer__links a:visited { color: var(--ct-dark-text-faint); }
.home-footer__links a:hover { color: var(--ct-accent); }

/* ---- Responsive ---- */
@media (max-width: 900px) {
  .featured__grid {
    grid-template-columns: repeat(2, 1fr);
  }
  .how-it-works__steps {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--ct-space-lg);
  }
  .hero__stats {
    gap: var(--ct-space-xl);
  }
}

@media (max-width: 640px) {
  .hero {
    padding: calc(var(--ct-nav-height) + var(--ct-space-xl)) var(--ct-space-md) var(--ct-space-xl);
    min-height: auto;
    min-height: 100svh;
  }
  .hero__stats {
    flex-direction: column;
    gap: var(--ct-space-md);
    align-items: center;
  }
  .hero__stat {
    display: flex;
    align-items: baseline;
    gap: var(--ct-space-sm);
  }
  .hero__stat-number {
    font-size: 1.75rem;
  }
  .featured__grid {
    grid-template-columns: 1fr;
  }
  .featured {
    padding: var(--ct-space-3xl) var(--ct-space-md);
  }
  .how-it-works {
    padding: var(--ct-space-3xl) var(--ct-space-md);
  }
  .how-it-works__steps {
    grid-template-columns: 1fr;
  }
  .categories {
    padding: var(--ct-space-xl) var(--ct-space-md) var(--ct-space-3xl);
  }
  .home-footer {
    padding: var(--ct-space-xl) var(--ct-space-md);
  }
  .home-footer__inner {
    flex-direction: column;
    text-align: center;
  }
}

/* Accessibility */
@media (prefers-reduced-motion: reduce) {
  .hero__dot {
    animation: none !important;
    opacity: 0.3;
  }
}
</style>
{% endblock %}

{% block content %}
<div class="home-shell" id="home-content">

  <!-- ================================================
       SECTION 1: HERO
       ================================================ -->
  <section class="hero">
    <div class="hero__dots">
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
      <span class="hero__dot"></span>
    </div>

    <div class="hero__content">
      <div class="hero__eyebrow">
        <span class="hero__eyebrow-dot"></span>
        {{ t('home.eyebrow') }}
      </div>

      <h1 class="hero__title">
        {{ t('home.title_prefix') }} <em>{{ t('home.title_highlight') }}</em><br>{{ t('home.title_suffix') }}
      </h1>

      <p class="hero__subtitle">
        {{ t('home.subtitle') }}
      </p>

      <a href="{{ url('/browse/') }}" class="hero__cta">
        {{ t('home.cta') }}
        <span class="hero__cta-arrow">&rarr;</span>
      </a>

      <div class="hero__stats">
        <div class="hero__stat">
          <span class="hero__stat-number">{{ total_traces }}</span>
          <span class="hero__stat-label">{{ t('home.stat_traces') }}</span>
        </div>
        <div class="hero__stat">
          <span class="hero__stat-number">{{ all_tags|length }}</span>
          <span class="hero__stat-label">{{ t('home.stat_categories') }}</span>
        </div>
        <div class="hero__stat">
          <span class="hero__stat-number">{{ top_languages|length }}+</span>
          <span class="hero__stat-label">{{ t('home.stat_languages') }}</span>
        </div>
      </div>
    </div>
  </section>

  <!-- ================================================
       SECTION 2: FEATURED TRACES
       ================================================ -->
  <section class="featured">
    <div class="featured__inner">
      <div class="featured__header ct-reveal">
        <div class="featured__label">{{ t('home.featured_label') }}</div>
        <h2 class="featured__title">{{ t('home.featured_title') }}</h2>
      </div>

      <div class="featured__grid">
        {% for trace in recent_traces[:6] %}
        <article class="featured__card ct-reveal" style="transition-delay: {{ loop.index0 * 80 }}ms;">
          <h3 class="featured__card-title">
            <a href="{{ url('/trace/' + trace.slug + '/') }}">{{ trace.title }}</a>
          </h3>
          <p class="featured__card-excerpt">{{ trace.context[:180] }}{% if trace.context|length > 180 %}...{% endif %}</p>
          <div class="featured__card-tags">
            {% for tag in trace.tags[:3] %}
            <a href="{{ url('/tag/' + tag + '/') }}" class="featured__card-tag{% if loop.index is odd %} featured__card-tag--violet{% endif %}">{{ tag }}</a>
            {% endfor %}
          </div>
        </article>
        {% endfor %}
      </div>
    </div>
  </section>

  <!-- ================================================
       SECTION 3: HOW IT WORKS
       ================================================ -->
  <section class="how-it-works">
    <div class="how-it-works__inner">
      <div class="how-it-works__header ct-reveal">
        <div class="how-it-works__label">{{ t('home.how_label') }}</div>
        <h2 class="how-it-works__title">{{ t('home.how_title') }}</h2>
      </div>

      <div class="how-it-works__steps">
        <div class="how-it-works__step ct-reveal" style="transition-delay: 0ms;">
          <div class="how-it-works__step-number">1</div>
          <h3 class="how-it-works__step-title">{{ t('home.step1_title') }}</h3>
          <p class="how-it-works__step-desc">
            {{ t('home.step1_desc') }}
          </p>
        </div>

        <div class="how-it-works__step ct-reveal" style="transition-delay: 100ms;">
          <div class="how-it-works__step-number">2</div>
          <h3 class="how-it-works__step-title">{{ t('home.step2_title') }}</h3>
          <p class="how-it-works__step-desc">
            {{ t('home.step2_desc') }}
          </p>
        </div>

        <div class="how-it-works__step ct-reveal" style="transition-delay: 200ms;">
          <div class="how-it-works__step-number">3</div>
          <h3 class="how-it-works__step-title">{{ t('home.step3_title') }}</h3>
          <p class="how-it-works__step-desc">
            {{ t('home.step3_desc') }}
          </p>
        </div>

        <div class="how-it-works__step ct-reveal" style="transition-delay: 300ms;">
          <div class="how-it-works__step-number">4</div>
          <h3 class="how-it-works__step-title">{{ t('home.step4_title') }}</h3>
          <p class="how-it-works__step-desc">
            {{ t('home.step4_desc') }}
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- ================================================
       SECTION 4: CATEGORIES
       ================================================ -->
  <section class="categories">
    <div class="categories__inner">
      <div class="categories__header ct-reveal">
        <div class="categories__label">{{ t('home.categories_label') }}</div>
        <h2 class="categories__title">{{ t('home.categories_title') }}</h2>
      </div>

      <div class="categories__pills ct-reveal" style="transition-delay: 100ms;">
        {% for tag, count in all_tags[:20] %}
        <a href="{{ url('/tag/' + tag + '/') }}" class="categories__pill">
          {{ tag }}
          <span class="categories__pill-count">{{ count }}</span>
        </a>
        {% endfor %}
      </div>

      <div class="categories__browse ct-reveal" style="transition-delay: 200ms;">
        <a href="{{ url('/browse/') }}">{{ t('home.categories_browse') }} &rarr;</a>
      </div>
    </div>
  </section>

  <!-- ================================================
       HOMEPAGE FOOTER (dark variant)
       ================================================ -->
  <footer class="home-footer">
    <div class="home-footer__inner">
      <div class="home-footer__brand">
        <span class="home-footer__logo-mark">C</span>
        <span class="home-footer__text">{{ t('home.footer_tagline') }}</span>
      </div>
      <ul class="home-footer__links">
        <li><a href="{{ url('/about/') }}">{{ t('footer.about') }}</a></li>
        <li><a href="https://docs.commontrace.org">{{ t('footer.docs') }}</a></li>
        <li><a href="https://github.com/commontrace">{{ t('footer.source') }}</a></li>
      </ul>
    </div>
  </footer>

</div>
{% endblock %}

{% block scripts %}
<script>
(function() {
  /* ========================================
     Homepage: Full-bleed layout setup
     ======================================== */

  // Move homepage content out of .ct-page into body (before the hidden footer)
  var homeContent = document.getElementById('home-content');
  var ctPage = document.querySelector('.ct-page');
  if (homeContent && ctPage) {
    // Move the home-content div to be a direct child of body, after the nav
    document.body.insertBefore(homeContent, ctPage);
    homeContent.classList.add('home-active');
  }

  // Make nav transparent on hero, solid on scroll
  var nav = document.getElementById('ct-nav');
  if (nav) {
    nav.classList.remove('ct-nav--light');
    nav.classList.add('ct-nav--home');

    var onScroll = function() {
      var scrollY = window.pageYOffset || document.documentElement.scrollTop;
      if (scrollY > 60) {
        nav.classList.add('ct-nav--scrolled');
      } else {
        nav.classList.remove('ct-nav--scrolled');
      }
    };
    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll();
  }

  /* ========================================
     Scroll Reveal for homepage sections
     ======================================== */
  if ('IntersectionObserver' in window) {
    var revealObserver = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          entry.target.classList.add('ct-visible');
          revealObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.08, rootMargin: '0px 0px -60px 0px' });

    document.querySelectorAll('.ct-reveal').forEach(function(el) {
      revealObserver.observe(el);
    });
  } else {
    document.querySelectorAll('.ct-reveal').forEach(function(el) {
      el.classList.add('ct-visible');
    });
  }
})();
</script>
{% endblock %}
